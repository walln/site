---
import Pagefind from "@/components/Pagefind.astro";
import { menuLinks } from "@/site.config";

// import Search from "@/components/Search.astro";

const url = new URL(Astro.request.url);
---

<header class="relative mb-12 mt-20 section-terminal" id="main-header">
	<div class="flex items-center justify-between">
		<div class="flex items-center gap-4">
			<a
				aria-current={url.pathname === "/" ? "page" : false}
				class="text-xl font-bold uppercase tracking-wider hover:text-accent transition-colors"
				href="/"
			>
				<span class="text-accent-green">$</span> NICK_WALL
			</a>
			<span class="text-quote hidden sm:inline">|</span>
			<nav
				aria-label="Main menu"
				class="hidden sm:flex items-center gap-2 text-xs"
				id="navigation-menu"
			>
				{
					menuLinks.map((link, index) => (
						<>
							{index > 0 && <span class="text-quote">/</span>}
							<a
								aria-current={
									url.pathname === link.path ? "page" : false
								}
								class={`uppercase tracking-wider transition-colors ${
									url.pathname === link.path
										? "text-accent-green"
										: "text-quote hover:text-white"
								}`}
								data-astro-prefetch
								href={link.path}
							>
								{link.title}
							</a>
						</>
					))
				}
			</nav>
		</div>
		<!-- <div class="flex items-center gap-2">
			<Search />
		</div> -->
		<Pagefind />
	</div>

	<!-- Mobile menu toggle -->
	<button
		aria-expanded="false"
		aria-label="Open main menu"
		class="group absolute right-4 top-4 sm:hidden"
		id="toggle-navigation-menu"
		type="button"
	>
		<svg
			aria-hidden="true"
			class="h-6 w-6 text-accent"
			fill="none"
			focusable="false"
			stroke="currentColor"
			stroke-linecap="round"
			stroke-linejoin="round"
			stroke-width="2"
			viewBox="0 0 24 24"
			xmlns="http://www.w3.org/2000/svg"
		>
			<path d="M4 6h16M4 12h16M4 18h16"></path>
		</svg>
	</button>

	<!-- Mobile navigation -->
	<nav
		aria-label="Mobile menu"
		class="absolute top-full left-0 right-0 mt-2 hidden bg-bg border border-quote p-4 group-[.menu-open]:block sm:hidden z-50"
		id="mobile-navigation-menu"
	>
		{
			menuLinks.map((link) => (
				<a
					aria-current={url.pathname === link.path ? "page" : false}
					class={`block py-2 uppercase text-xs tracking-wider border-b border-dotted border-quote last:border-0 ${
						url.pathname === link.path
							? "text-accent-green"
							: "text-quote hover:text-white"
					}`}
					data-astro-prefetch
					href={link.path}
				>
					<span class="mr-2">â–¶</span>
					{link.title}
				</a>
			))
		}
	</nav>
</header>

<script>
	// Handle mobile menu toggle
	const toggleButton = document.getElementById("toggle-navigation-menu");
	const header = document.getElementById("main-header");

	toggleButton?.addEventListener("click", () => {
		const isOpen = header?.classList.contains("menu-open");
		header?.classList.toggle("menu-open");
		toggleButton.setAttribute("aria-expanded", String(!isOpen));
	});

	// Close menu when clicking outside
	document.addEventListener("click", (e) => {
		if (!header?.contains(e.target as Node)) {
			header?.classList.remove("menu-open");
			toggleButton?.setAttribute("aria-expanded", "false");
		}
	});
</script>
